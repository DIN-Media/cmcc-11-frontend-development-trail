<?xml version="1.0" encoding="UTF-8"?>
<local:CatalogLinkPropertyFieldBase
  xmlns="exml:ext.config"
  xmlns:editor="exml:com.coremedia.cms.editor.sdk.config"
  xmlns:exml="http://www.jangaroo.net/exml/0.8"
  xmlns:fx="http://ns.adobe.com/mxml/2009"
  xmlns:local="com.coremedia.ecommerce.studio.components.link.*"
  xmlns:ec="exml:com.coremedia.ecommerce.studio.config"
  xmlns:ui="exml:com.coremedia.ui.config"
  readOnlyValueExpression="{PropertyEditorUtil.createReadOnlyValueExpression(config.bindTo, config.forceReadOnlyValueExpression)}"
  dropAreaHandler="{CatalogHelper.getInstance().openCatalog}"
  htmlFeedback="{CatalogDragDropVisualFeedback.getHtmlFeedback}"
  selectedPositionsExpression="{getSelectedPositionsExpression()}"
  selectedValuesExpression="{getSelectedValuesExpression()}"
>
  <fx:Metadata>
    [ResourceBundle('com.coremedia.ecommerce.studio.ECommerceStudioPlugin')]
  </fx:Metadata>
  <fx:Declarations>
    <fx:Object id="model"/>
    <fx:String id="propertyName"/>
    <fx:Array id="additionalToolbarItems"/>
    <fx:Boolean id="hideOpenInTab"/>
    <fx:Boolean id="hideRemove"/>
    <fx:Array id="linkTypeNames"/>
    <fx:Function id="createStructFunction"/>
    <fx:Number id="maxCardinality"/>
  </fx:Declarations>
  <fx:Script><![CDATA[
    import com.coremedia.cms.editor.sdk.util.PropertyEditorUtil;
    import com.coremedia.ecommerce.studio.dragdrop.CatalogDragDropVisualFeedback;
    import com.coremedia.ecommerce.studio.helper.CatalogHelper;

    public static const xtype:String = "com.coremedia.ecommerce.studio.config.catalogLinkPropertyField";

    private var config:CatalogLinkPropertyField;

    public native function CatalogLinkPropertyField(config:CatalogLinkPropertyField = null);
    ]]></fx:Script>

  <local:linkListWrapper>
    <ec:CatalogLinkListWrapper bindTo="{config.bindTo}"
                               model="{config.model}"
                               propertyName="{config.propertyName}"
                               maxCardinality="{config.maxCardinality}"
                               createStructFunction="{config.createStructFunction}"
                               linkTypeNames="{config.linkTypeNames}"/>
  </local:linkListWrapper>
  <local:fields>
    <ui:DataField name="type"
                  mapping=""
                  convert_="{convertTypeLabel}"/>
    <ui:DataField name="typeCls"
                  mapping=""
                  convert_="{convertTypeCls}"/>
    <ui:DataField name="id"
                  mapping=""
                  convert_="{convertIdLabel}"/>
    <ui:DataField name="name"
                  mapping=""
                  convert_="{convertNameLabel}"/>
    <ui:DataField name="thumbnailUrl"
                  mapping=""
                  ifUnreadable=""/>
  </local:fields>
  <local:columns>
    <editor:ThumbnailColumn width="100"
                            hidden="{config.showThumbnails === false}"
                            renderer="{thumbColRenderer}"/>
    <editor:TypeIconColumn sortable="false"/>
    <!--TODO: remove align after EXT FIX-->
    <GridColumn align="left"
                header="{resourceManager.getString('com.coremedia.ecommerce.studio.ECommerceStudioPlugin', 'id_header')}"
                stateId="id"
                dataIndex="id"
                sortable="false"
                flex="1"/>
    <editor:NameColumn flex="1"
                       sortable="false"/>
  </local:columns>
  <local:tbar>
    <ec:CatalogLinkToolbar additionalToolbarItems="{config.additionalToolbarItems}"
                           propertyName="{config.propertyName}"
                           forceReadOnlyValueExpression="{config.forceReadOnlyValueExpression}"
                           readOnlyValueExpression="{config.readOnlyValueExpression}"
                           selectedValuesExpression="{getSelectedValuesExpression()}"
                           selectedPositionsExpression="{getSelectedPositionsExpression()}"
                           bindTo="{config.bindTo}"
                           hideOpenInTab="{config.hideOpenInTab}"
                           hideRemove="{config.hideRemove}"/>
  </local:tbar>
  <local:plugins exml:mode="append">
    <ui:ContextMenuPlugin>
      <ui:contextMenu>
        <ec:CatalogLinkContextMenu propertyName="{config.propertyName}"
                                   bindTo="{config.bindTo}"
                                   forceReadOnlyValueExpression="{config.forceReadOnlyValueExpression}"
                                   readOnlyValueExpression="{config.readOnlyValueExpression}"
                                   selectedValuesExpression="{getSelectedValuesExpression()}"
                                   selectedPositionsExpression="{getSelectedPositionsExpression()}"
                                   hideOpenInTab="{config.hideOpenInTab}"
                                   hideRemove="{config.hideRemove}"/>
      </ui:contextMenu>
    </ui:ContextMenuPlugin>

  </local:plugins>

</local:CatalogLinkPropertyFieldBase>
