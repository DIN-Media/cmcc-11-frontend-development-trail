<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:task="http://www.springframework.org/schema/task"
       xsi:schemaLocation="http://www.springframework.org/schema/beans   http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd">

  <context:annotation-config/>

  <!--obey the ordering:
  1. imports
  2. beans & customizer-->

  <!-- Import Framework Configuration -->
  <import resource="classpath:/framework/spring/workflowserver.xml"/>
  <import resource="classpath:/com/coremedia/blueprint/base/multisite/bpbase-sitemodel.xml"/>
  <import resource="classpath:/com/coremedia/blueprint/base/workflow/bpbase-workflowserver.xml"/>
  <import resource="classpath:/framework/spring/workflow-archive.xml"/>

  <!-- Place your beans here  -->

  <!--
    Provide a SitesServices backed by the workflowserver's connection.
    (The translation workflows need it.)
  -->
  <bean id="sitesService" class="com.coremedia.cap.multisite.impl.SitesServiceImpl">
    <property name="capConnection" ref="connection"/>
    <property name="siteModel" ref="siteModel"/>
  </bean>

  <!--
    Regularly clean up "in translation" states left over by aborted workflows.
   -->

  <bean id="defaultTranslationWorklowDerivedContentsStrategy" class="com.coremedia.translate.workflow.DefaultTranslationWorkflowDerivedContentsStrategy">
    <description>
      A strategy for extracting derived contents from the default translation.xml workflow definition.
      You can alter this definition and/or add additional strategy beans when using a modified translation workflow.
    </description>
    <property name="processDefinitionName" value="Translation"/>
    <property name="derivedContentsVariable" value="derivedContents"/>
    <property name="masterContentObjectsVariable" value="masterContentObjects"/>
  </bean>

  <bean id="cleanInTranslation" class="com.coremedia.translate.workflow.impl.CleanInTranslation"/>

  <task:scheduler id="cleanInTranslationScheduler"/>

  <task:scheduled-tasks scheduler="cleanInTranslationScheduler">
    <task:scheduled ref="cleanInTranslation" method="run" initial-delay="10000" fixed-delay="5000"/>
  </task:scheduled-tasks>

</beans>
