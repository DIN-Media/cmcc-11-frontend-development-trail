<?xml version="1.0" encoding="UTF-8"?>
<local:TaxonomySelectionWindowBase
        xmlns:fx="http://ns.adobe.com/mxml/2009"
        xmlns:local="com.coremedia.blueprint.studio.taxonomy.chooser.*"
        xmlns:exml="http://www.jangaroo.net/exml/0.8"
        xmlns:taxonomy="exml:com.coremedia.blueprint.studio.config.taxonomy"
        xmlns="exml:ext.config"
        xmlns:ui="exml:com.coremedia.ui.config"
        xmlns:editor="com.coremedia.cms.editor.sdk.util.*"
        id_="{ID}"
        stateId="taxonomySelectionState"
        stateful="true"
        title="{resolveTitle(config)}"
        width="510"
        height="550"
        modal="true"
        constrainHeader="true"
        ui="{WindowSkin.GRID_200.getSkin()}">
  <fx:Metadata>
    [ResourceBundle('com.coremedia.blueprint.studio.taxonomy.TaxonomyStudioPlugin')]
    [ResourceBundle('com.coremedia.cms.editor.Editor')]
    [ResourceBundle('com.coremedia.icons.CoreIcons')]
  </fx:Metadata>
  <fx:Script><![CDATA[
    import com.coremedia.ui.bem.SpacingBEMEntities;
    import com.coremedia.ui.data.ValueExpression;
    import com.coremedia.ui.skins.ButtonSkin;
    import com.coremedia.ui.skins.TextfieldSkin;
    import com.coremedia.ui.skins.WindowSkin;

    public static const xtype:String = "com.coremedia.blueprint.studio.config.taxonomy.taxonomySelectionWindow";
    public static const ID:String = "taxonomySelectionDialog";

    private var config:TaxonomySelectionWindow;

    public native function TaxonomySelectionWindow(config:TaxonomySelectionWindow = null);

    /**
     * the property expression to bind in this field
     */
    [ExtConfig]
    public var propertyValueExpression:ValueExpression;

    [ExtConfig]
    public var bindTo:ValueExpression;

    [ExtConfig]
    public var siteSelectionExpression:ValueExpression;

    /**
     * An optional ValueExpression which makes the component read-only if it is evaluated to true.
     */
    [ExtConfig]
    public var forceReadOnlyValueExpression:ValueExpression;

    /** If true, only one item can be selected from the list. */
    [ExtConfig]
    public var singleSelection:String;
    ]]></fx:Script>

  <local:layout>
    <layout_VBox align="stretch"/>
  </local:layout>
  <local:items>
    <Container>
      <items>
        <ui:IconDisplayField iconCls="{resourceManager.getString('com.coremedia.icons.CoreIcons', 'search')}" />
        <taxonomy:TaxonomySearchField searchResultExpression="{getSearchResultExpression()}"
                                      siteSelectionExpression="{config.siteSelectionExpression}"
                                      taxonomyIdExpression="{config.taxonomyIdExpression}"
                                      resetOnBlur="true"
                                      cls="taxonomy-search-field-selector"
                                      flex="1"
                                      emptyText="{resourceManager.getString('com.coremedia.blueprint.studio.taxonomy.TaxonomyStudioPlugin', 'TaxonomyChooser_search_tag_emptyText')}"
                                      ui="{TextfieldSkin.DEFAULT.getSkin()}"
                                      itemId="taxonomySearchField">
          <taxonomy:plugins exml:mode="append">
            <ui:BindPropertyPlugin componentProperty="disabled" bindTo="{getLoadingExpression()}" />
          </taxonomy:plugins>
        </taxonomy:TaxonomySearchField>
      </items>
      <layout>
        <layout_HBox align="stretch"/>
      </layout>
    </Container>

    <FieldContainer labelAlign="top"
                    labelSeparator=""
                    fieldLabel="{resolveSelectionTitle(config.singleSelection)}"
                    height="128">
      <layout>
        <layout_Fit/>
      </layout>
      <items>
        <taxonomy:TaxonomyLinkListGridPanel id_="selectedTaxonomies"
                                            scrollable="true"
                                            selectionMode="SINGLE"
                                            bindTo="{config.bindTo}"
                                            removeCallback="{removedFromLinkListCallback}"
                                            taxonomyIdExpression="{config.taxonomyIdExpression}"
                                            readOnlyValueExpression="{getLoadingExpression()}"
                                            emptyText="{resourceManager.getString('com.coremedia.blueprint.studio.taxonomy.TaxonomyStudioPlugin', 'TaxonomyLinkList_empty_chooser_text')}">
          <taxonomy:linkListWrapper>
            <editor:MemoryLinkListWrapper linksVE="{getSelectionExpression()}"
                                          linkTypeName="CMTaxonomy"/>
          </taxonomy:linkListWrapper>
        </taxonomy:TaxonomyLinkListGridPanel>
      </items>
    </FieldContainer>
    <FieldContainer labelAlign="top"
                    labelSeparator=""
                    fieldLabel="{resourceManager.getString('com.coremedia.blueprint.studio.taxonomy.TaxonomyStudioPlugin', 'TaxonomyChooser_selection_text')}"
                    flex="1">
      <layout>
        <layout_Fit/>
      </layout>
      <items>
        <taxonomy:TaxonomySelector selectionExpression="{getSelectionExpression()}"
                                   singleSelection="{config.singleSelection}"
                                   taxonomyIdExpression="{config.taxonomyIdExpression}"
                                   loadingExpression="{getLoadingExpression()}"
                                   nodePathExpression="{getNodePathExpression()}"
                                   forceReadOnlyValueExpression="{config.forceReadOnlyValueExpression}"/>
      </items>
    </FieldContainer>
  </local:items>
  <local:plugins>
    <ui:VerticalSpacingPlugin modifier="{SpacingBEMEntities.VERTICAL_SPACING_MODIFIER_200}"/>
  </local:plugins>
  <local:fbar>
    <Toolbar>
      <items>
        <Button ui="{ButtonSkin.FOOTER_PRIMARY.getSkin()}"
                scale="small"
                text="{resourceManager.getString('com.coremedia.cms.editor.Editor', 'btn_ok')}"
                handler="{okPressed}">
          <plugins>
            <ui:BindPropertyPlugin componentProperty="disabled" bindTo="{getLoadingExpression()}" />
          </plugins>
        </Button>
        <Button ui="{ButtonSkin.FOOTER_SECONDARY.getSkin()}"
                scale="small"
                text="{resourceManager.getString('com.coremedia.cms.editor.Editor', 'dialog_defaultCancelButton_text')}"
                handler="{ function():void { cancelPressed(); }}" />
      </items>
    </Toolbar>
  </local:fbar>
</local:TaxonomySelectionWindowBase>
